<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 4 - Matrix Inversion</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <header class="d-flex justify-content-center text-light fs-5 py-4 bg-primary shadow">
        Iterative Matrix Inversion
    </header>

    <div class="container mt-5">
        <h3 class="text-center">Iterative Method for Matrix Inversion</h3>
        <p class="text-center">Compute the inverse of a matrix using an iterative method with an initial guess based on its trace.</p>

        <div class="mb-3">
            <label for="rows" class="form-label">Number of Rows:</label>
            <input type="number" id="rows" class="form-control" min="1" placeholder="Enter number of rows">
        </div>

        <div class="mb-3">
            <label for="cols" class="form-label">Number of Columns:</label>
            <input type="number" id="cols" class="form-control" min="1" placeholder="Enter number of columns">
        </div>

        <button class="btn btn-primary" onclick="generateMatrixInputs()">Generate Matrix</button>

        <div id="matrix_container" class="mt-4"></div>

        <button id="compute_btn" class="btn btn-success mt-3 d-none" onclick="compute_matrix_inverse()">Compute Inverse</button>

        <h3 class="mt-4">Inverse Matrix:</h3>
        <pre id="matrix_output" class="p-3 border bg-light"></pre>
    </div>

    <script>
        function generateMatrixInputs() {
            let rows = parseInt(document.getElementById("rows").value);
            let cols = parseInt(document.getElementById("cols").value);
            let container = document.getElementById("matrix_container");

            if (isNaN(rows) || isNaN(cols) || rows <= 0 || cols <= 0) {
                alert("Please enter valid matrix dimensions.");
                return;
            }

            container.innerHTML = ""; // Очищаем контейнер
            let table = document.createElement("table");
            table.className = "table table-bordered text-center";

            for (let i = 0; i < rows; i++) {
                let row = document.createElement("tr");
                for (let j = 0; j < cols; j++) {
                    let cell = document.createElement("td");
                    let input = document.createElement("input");
                    input.type = "number";
                    input.className = "form-control text-center";
                    input.style.width = "80px";
                    input.setAttribute("data-row", i);
                    input.setAttribute("data-col", j);
                    cell.appendChild(input);
                    row.appendChild(cell);
                }
                table.appendChild(row);
            }

            container.appendChild(table);
            document.getElementById("compute_btn").classList.remove("d-none"); // Показываем кнопку вычисления
        }

        function compute_matrix_inverse() {
            let rows = parseInt(document.getElementById("rows").value);
            let cols = parseInt(document.getElementById("cols").value);
            let matrix = [];

            for (let i = 0; i < rows; i++) {
                let row = [];
                for (let j = 0; j < cols; j++) {
                    let value = document.querySelector(`input[data-row="${i}"][data-col="${j}"]`).value;
                    row.push(parseFloat(value));
                }
                matrix.push(row);
            }

            sendRequest("http://localhost:5000/invert-matrix", { matrix: matrix }, function(response) {
                if (response.error) {
                    document.getElementById("matrix_output").innerText = "Error: " + response.error;
                } else {
                    document.getElementById("matrix_output").innerText = JSON.stringify(response.inverse_matrix, null, 2);
                }
            });
        }

        function sendRequest(url, data, callback) {
            fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(callback)
            .catch(error => console.error("Error:", error));
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
